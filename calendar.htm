<!DOCTYPE html>
<html lang="en">
<head>
	<title>Reservation calendar</title>
	<link rel="stylesheet" type="text/css" href="stylesheet.css" />
	<script type="text/javascript">
		var theDate = new Date();
		theDate.setDate(1);
		var appointments = new AppointmentBook();

		function getRows(currentDate)
		//return the number of calendar rows in the month for the date supplied
		{
			
			var startOfMonth = firstDayOfMonth(currentDate);
			var numDaysInMonth = getDaysInMonth(currentDate);

			if (currentDate.getMonth() == 1 && startOfMonth == 0 && numDaysInMonth == 28)
			{
				return 4;
			}

			if((startOfMonth == 6 && numDaysInMonth >= 30) || (startOfMonth == 5 && numDaysInMonth == 31))
			{
				return 6;
			}

			return 5;
		}

		function getDaysInMonth(aDate)
		//finds number of days in month
		{
			var today = aDate.getDate();
			aDate.setDate(1);
			aDate.setMonth(aDate.getMonth() + 1);
			aDate.setDate(aDate.getDate() - 1);
			var daysInMonth = aDate.getDate();
			aDate.setDate(today);
			return daysInMonth;
		}

		function firstDayOfMonth(aDate)
		//returns the day value for the first day of the month for a supplied date
		{
			var today = aDate.getDate();
			aDate.setDate(1);
			var firstOfMonth = aDate.getDay();
			aDate.setDate(today);
			return firstOfMonth;
		}

		function CalendarDate(aDate)
		//Calendar date object constructor
		{
			var cBox = document.createElement("div");
			cBox.appendChild(document.createTextNode(aDate.getDate()));

			var listOfAppts = document.createElement("ul");
			var existingAppts = appointments.getAppointments(aDate);

			//adds elements to list of appointments
			if (existingAppts != null)
			{
				for (var a = 0; a < existingAppts.length; a++)
				{
					var apptName = existingAppts[a].getApptName();
					var liElem = document.createElement("li");
					liElem.appendChild(document.createTextNode(apptName));
					listOfAppts.appendChild(liElem);
				}
			}

			this.apptList = listOfAppts;
			cBox.appendChild(listOfAppts);
			this.displayElement = cBox;

			this.displayElement.addEventListener("click", this, false)

			CalendarDate.prototype.click = function(e)
			{
				//function to initialize creation of a reservation
				makeAppointment(this.selfDate);
			}

			CalendarDate.prototype.handleEvent = function(e)
			{
				switch (e.type)
				{
					case "click": this.click(e);
				}
			}

			this.selfDate = new Date(aDate.getFullYear(), aDate.getMonth(), aDate.getDate());

			CalendarDate.prototype.getSelfDate = function()
			{
				return this.selfDate;
			}
		}

		function displayCalendar(aDate)
		//builds a calendar of the month for the supplied date
		{
			//calendar display formatting information
			var numRows = getRows(aDate);

			//temporary date object to build calendar
			var monthStart = firstDayOfMonth(aDate);
			var workingDate = new Date(aDate.getFullYear(), aDate.getMonth());
			workingDate.setDate(1);
			workingDate.setDate(workingDate.getDate() - monthStart);

			//builds calendar display
			for (var r = 0; r < 5; r++)
			{
				var rowDiv = document.createElement("div");

				for (var d = 0; d < 7 /*days in week */; d++)
				{
					var displayBox = new CalendarDate(workingDate);

					if(workingDate.getMonth() != theDate.getMonth())
					{
						displayBox.displayElement.className = "otherMonthDate";
					}
					else
					{
						displayBox.displayElement.className = "thisMonthDate";
					}

					rowDiv.appendChild(displayBox.displayElement);
					workingDate.setDate(workingDate.getDate() + 1);
				}
				document.getElementById("calendarDisplay").appendChild(rowDiv);
			}

		}

		function monthToString(monthNum)
		//takes an integer and returns string of month name
		{
			switch (monthNum)
			{
				case 0:
				return "January";
				case 1:
				return "February";
				case 2:
				return "March";
				case 3:
				return "April";
				case 4:
				return "May";
				case 5:
				return "June";
				case 6:
				return "July";
				case 7:
				return "August";
				case 8:
				return "September";
				case 9:
				return "October";
				case 10:
				return "November";
				case 11:
				return "December";
			}
		}
		
		function arrowRight_onclick()
		{
			nextMonth();
		}

		function arrowLeft_onclick()
		{
			previousMonth();
		}
		
		function AppointmentBook()
		//constructor for AppointmentBook object
		{
			AppointmentBook.prototype.addAppointment = function(appt)
			{
				var resDate = appt.getApptDate();
				if (this[resDate] == undefined)
				{
					this[resDate] = new Array();
					this[resDate][this[resDate].length] = appt;
				}
				else
				{
					this[resDate][this[resDate].length] = appt;
				}
			}
			AppointmentBook.prototype.getAppointments = function(aDate)
			//if appointments exist for a supllied date, returns an array of Appointments
			//otherwise returns null
			{
				var resDate = (aDate.getMonth() + "-" + aDate.getDate())
				if (this[resDate] == undefined)
				{
					return null;
				}
				else
				{
					return this[resDate];
				}
			}
		}

		function buildDisplay()
		{
			displayCalendar(theDate);
			var dateString = monthToString(theDate.getMonth()) + ", " + theDate.getFullYear();
			document.getElementById("headerInfo").innerHTML = dateString;
		}

		function nextMonth()
		{	
			theDate.setMonth(theDate.getMonth() + 1);
			document.getElementById("calendarDisplay").innerHTML = "";
			buildDisplay();
			
		}

		function previousMonth()
		{
			theDate.setMonth(theDate.getMonth() - 1);
			document.getElementById("calendarDisplay").innerHTML = "";
			buildDisplay();
		}

		function openReservationForm(aCalendarDate)
		//Open reservation form to make appointment for selected date
		{
		document.getElementById("welcomeText").style.display = "none";
		document.getElementById("appointmentForm").style.display = "block";
		document.getElementById("appointmentFormDateInfo").innerHTML = 
			("Make appointment for " + aCalendarDate.getSelfDate().toDateString());
		selectedDate = aCalendarDate;
		}

		function makeAppointment(selectedDate)
		{
			if (document.getElementById("appointmentName").value == "")
			{
				alert("Please enter a name for your appointment.");
				return;
			}
			//creates new appointment and adds it to book
			var apptName = document.getElementById("appointmentName").value;
			var appt = new Appointment(apptName, selectedDate.getSelfDate());
			appointments.addAppointment(appt);

			//updates visible appointments
			var liElem = document.createElement("li");
			liElem.appendChild(document.createTextNode(apptName));
			selectedDate.apptList.appendChild(liElem);

			//clears form and resets window
			document.getElementById("appointmentForm").style.display = "none";
			document.getElementById("welcomeText").style.display = "block";
			document.getElementById("appointmentName").value = "";
		}
		function Appointment(aName, aDate)
		{
			//object to hold appointment information
			this.aptName = aName;
			this.aptMonth = aDate.getMonth();
			this.aptDate = aDate.getDate();

			Appointment.prototype.getApptDate = function()
			{
				return (this.aptMonth + "-" + this.aptDate);
			}
			Appointment.prototype.getApptName = function()
			{
					return this.aptName;
			}
		}

		function window_onload()
			{
				buildDisplay();
			}
	</script>
</head>
<body onload="window_onload()" >
	<div id="widgetWindow">
		<div id="calendar">
			<div id="calendarHeader">
				<div id="calendarNavigation">
					<img id="leftArrow" src="leftArrow.png" onclick="arrowLeft_onclick()"/>
					<h2 id="headerInfo"></h2>
					<img id="rightArrow" src="rightArrow.png" onclick="arrowRight_onclick()" />
				</div>
				<div id="dayOfWeekDisplay">
					<div class="dayDisplay">Sunday</div>
					<div class="dayDisplay">Monday</div>
					<div class="dayDisplay">Tuesday</div>
					<div class="dayDisplay">Wednesday</div>
					<div class="dayDisplay">Thursday</div>
					<div class="dayDisplay">Friday</div>
					<div class="dayDisplay">Saturday</div>
				</div>
			</div>
			<div id="calendarDisplay">
			</div>
		</div>
		<div id="interactionWindow">
			<h1 id="interactionText">Please click on a date to make an appointment.</h1>
			<form id="appointmentForm" style="display:none">
				<h1 id="appointmentFormDateInfo" style="font-size:15px"></h1><br />
				<label>Your Name: <input type="text" id="appointmentName" /> </label>
				<input type="button" value="Make Appointment" onclick="makeAppointment()" />
			</form>
		</div>
	</div>
</body>
</html>